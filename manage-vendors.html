<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Manage Vendors | Route Buddy - Admin</title>
  <!-- Google Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet"/>
  <!-- FontAwesome -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"/>
  <style>
    :root {
      --primary-gradient: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      --secondary-gradient: linear-gradient(135deg, #764ba2 0%, #667eea 100%);
      --glass-bg: rgba(255,255,255,0.1);
      --glass-border: rgba(255,255,255,0.2);
      --shadow-light: 0 8px 32px rgba(102,126,234,0.09);
      --shadow-medium: 0 12px 40px rgba(102,126,234,0.1);
      --shadow-heavy: 0 18px 50px rgba(102,126,234,0.16);
      --text-primary: #2d3748;
      --text-secondary: #718096;
      --bg-primary: #f7fafc;
      --border-radius: 16px;
      --transition: all 0.3s cubic-bezier(0.4,0,0.2,1);
    }
    * { box-sizing: border-box;}
    body {
      font-family: 'Poppins', sans-serif; color: var(--text-primary);
      background: var(--bg-primary); min-height: 100vh;
      margin: 0; padding: 0; display: flex; flex-direction: row;
      overflow-x: hidden;
    }
    .sidebar {
      width: 280px; background: var(--primary-gradient); color: white;
      min-height: 100vh; padding: 2rem 1.5rem; position: sticky; top: 0;
      box-shadow: var(--shadow-medium); border-right: 1px solid var(--glass-border);
      height: 100%; z-index: 1000; transition: left 0.3s;
    }
    .sidebar-header { margin-bottom: 3rem; }
    .sidebar h2 { font-size: 1.75rem; font-weight: 700; display: flex; align-items: center; gap: 0.75rem;}
    .sidebar h2 i { color: #ffd700; font-size: 2rem;}
    .nav-menu { list-style: none; padding: 0;}
    .nav-item { margin: 0.5rem 0;}
    .nav-link {
      color: rgba(255,255,255,0.96); text-decoration: none;
      font-weight: 500; display: flex; align-items: center; gap: 1rem;
      padding: 1rem 1.25rem; border-radius: 12px; transition: var(--transition); position: relative;
    }
    .nav-link:hover, .nav-link.active {
      background: rgba(255,255,255,0.15);
      font-weight: 600; color: #ffd700;
      transform: translateX(8px);
    }
    .nav-link.active { background: rgba(255,255,255,0.2); color: white;}
    .nav-link i { font-size: 1.12rem; width: 20px; text-align: center;}
    /* Main Content */
    .main {
      flex: 1; padding: 2.5rem 2.7rem; min-height: 100vh;
      background: var(--bg-primary); position: relative; overflow-x: auto;
    }
    .main-header { margin-bottom: 2.7rem; }
    .main h1 { font-size: 2.1rem; font-weight: 700;
      background: var(--primary-gradient); -webkit-background-clip: text; -webkit-text-fill-color: transparent;
      background-clip: text; margin-bottom: 0.3rem;
    }
    .main-subtitle { color: var(--text-secondary); font-size: 1.06rem;}
    /* Top actions row */
    .vendor-actions {
      display: flex; justify-content: space-between; align-items: center;
      flex-wrap: wrap; margin-bottom: 2rem; gap: 1rem
    }
    .vendor-actions form {
      display: flex; gap: 0.95rem; flex-wrap: wrap;
      align-items: center;
    }
    .vendor-actions input, .vendor-actions select {
      padding: 0.6rem 1rem; border-radius: 10px; border: 1px solid #e2e8f0;
      font-size: 1rem; font-family: inherit; outline: none; background: #fff;
      transition: border-color 0.2s;
    }
    .vendor-actions button, .btn {
      padding: 0.58rem 1.25rem; border-radius: 16px; border: none;
      font-family: inherit; font-size: 1rem; font-weight: 600;
      background: var(--primary-gradient); color: white; cursor: pointer;
      transition: var(--transition); display: flex; align-items: center; gap: 0.7rem;
      box-shadow: 0 2px 8px #667eea11;
    }
    .vendor-actions button:active, .btn:active { transform: scale(0.99);}
    .btn-add { background: linear-gradient(135deg, #36c7a5 0%, #764ba2 74%);}
    .btn-secondary { background: #e2e8f0; color: #444; border: none;}
    /* Table */
    .vendor-table-section {
      background: #fff; border-radius: var(--border-radius); box-shadow: var(--shadow-light);
      padding: 2rem; width: 100%; overflow-x: auto; min-width: 0;
    }
    table {width: 100%; border-collapse: collapse; margin-bottom: 0.6rem;}
    th, td {
      padding: 0.82rem 1rem; text-align: left; border-bottom: 1px solid #edf2f7;
      font-size: 1rem; vertical-align: middle;
    }
    th { font-size: 0.98rem; color: var(--text-secondary); background: #f8fafc; font-weight: 600;}
    tr:hover { background: #f7f7fa;}
    .badge { padding: 0.18rem 0.8rem; border-radius: 12px; font-size: 0.89rem; display: inline-block;}
    .badge-success { background: #e7fbe7; color: #1da74a;}
    .badge-danger  { background: #ffe7e7; color: #db3939;}
    .badge-inactive { background: #e4e8f0; color: #7683a2;}
    /* Actions icons */
    .btn-table {
      padding: 0.33rem 0.75rem; border-radius: 10px; font-size: 0.96rem;
      margin-right: 0.4rem; border: none; cursor: pointer; background: #e2e8f0; color: #6694ca;
      transition: background .18s;
    }
    .btn-table:hover { background: #667eea; color: #fff;}
    .btn-table.del { background: #ffe7e7; color: #e74c3c;}
    .btn-table.del:hover { background: #db3939; color: #fff;}
    /* Modal */
    .modal-backdrop {
      display:none; position:fixed;inset:0;z-index:1002;background:#2228;
      align-items:center;justify-content:center;
    }
    .modal-backdrop.active { display: flex;}
    .modal {
      background: #fff; border-radius: 18px; padding: 2rem 2.2rem; min-width: 340px; max-width: 98vw;
      box-shadow: var(--shadow-medium); position:relative; animation: fadeInUp .4s;
    }
    .modal h2 { margin-bottom: 1rem; font-size: 1.27rem; color: #38c7a5;}
    .modal label { display:block; font-weight: 500; margin-top: 1.1rem; margin-bottom: 0.2rem;}
    .modal input, .modal select {
      width: 100%; padding: 0.7rem; border-radius: 10px; border: 1px solid #e2e8f0; margin-bottom: 0.4rem;
      font-size: 1rem; font-family:inherit; outline: none; background: #f7fafc;
      transition: border-color 0.2s;
    }
    .modal button, .modal .btn { margin-top: 1.2rem;}
    .modal .input-error { color: #e74c3c; font-size: 0.85em; min-height: 1.15em;}
    .modal-footer {
      display: flex; gap: 1rem; justify-content: flex-end; margin-top: 1.4rem;
    }
    @keyframes fadeInUp { from { opacity: 0; transform: translateY(24px);} to { opacity: 1; transform: none;}}
    /* Mobile */
    @media (max-width:1030px) {.main{padding:2.2rem 1rem;}}
    @media (max-width:800px) {.sidebar {width: 100%; min-width:170px; padding: 1.2rem 0.7rem;}}
    @media (max-width: 600px) {
      .main{ padding: 1.25rem 3vw; }
      .vendor-actions form {flex-direction: column; gap:0.62rem;}
      .vendor-table-section{padding:1rem 0.3rem;}
      .modal{padding:1rem 0.5rem;}
      th, td { font-size: 0.95rem;}
    }
    /* Mobile sidebar */
    .mobile-menu-toggle {
      display:none; position:fixed; top:1rem; left:1rem; z-index:1001;
      background: var(--primary-gradient); color: white; border:none;
      padding: 0.75rem; border-radius: 12px; font-size: 1.2rem; cursor:pointer;
      box-shadow: var(--shadow-medium);
    }
    @media (max-width:768px){
      .sidebar {
        position: fixed; left: -282px; z-index: 1000; top: 0; height: 100vh; width: 240px; transition: left 0.3s;
      }
      .sidebar.open { left:0; }
      .mobile-menu-toggle { display:block; }
    }
    .sidebar-backdrop {
      display:none; position:fixed;inset:0;background:rgba(0,0,0,0.36);z-index:999;
    }
    .sidebar.open ~ .sidebar-backdrop { display:block; }
  </style>
</head>
<body>
  <!-- Mobile Menu Toggle -->
  <button class="mobile-menu-toggle" onclick="toggleSidebar()">
    <i class="fas fa-bars"></i>
  </button>
  <!-- Sidebar -->
  <aside class="sidebar" id="sidebar">
    <div class="sidebar-header">
      <h2><i class="fas fa-route"></i> RouteBuddy</h2>
    </div>
    <ul class="nav-menu">
      <li class="nav-item"><a href="dashboard.html" class="nav-link active"><i class="fas fa-tachometer-alt"></i> Dashboard</a></li>
      <li class="nav-item"><a href="manage-users.html" class="nav-link"><i class="fas fa-users"></i> Manage Users</a></li>
      <li class="nav-item"><a href="manage-vendors.html" class="nav-link"><i class="fas fa-store"></i> Manage Vendors</a></li>
      <li class="nav-item"><a href="requests.html" class="nav-link"><i class="fas fa-clipboard-list"></i> Requests</a></li>
      <li class="nav-item"><a href="feedbacks.html" class="nav-link"><i class="fas fa-comments"></i> Feedbacks</a></li>
      <li class="nav-item"><a href="records.html" class="nav-link"><i class="fas fa-calendar-check"></i> Booking Records</a></li>
      <li class="nav-item"><a href="transactions.htmll" class="nav-link"><i class="fas fa-credit-card"></i> Transactions</a></li>
      <li class="nav-item"><a href="settings.html" class="nav-link"><i class="fas fa-shield-alt"></i> Security Settings</a></li>
    </ul>
  </aside>
  <div class="sidebar-backdrop" onclick="toggleSidebar()"></div>

  <!-- Main Content -->
  <main class="main">
    <div class="main-header">
      <h1>Manage Vendors</h1>
      <p class="main-subtitle">View, add, edit, or filter vendors in the platform.</p>
    </div>
    <div class="vendor-actions">
      <form id="vendorFilterForm" autocomplete="off" onsubmit="filterVendors(event)">
        <input type="text" id="searchVendor" placeholder="Search by organization/email/phone" />
        <select id="filterRegion">
          <option value="">All Regions</option>
          <option value="Chennai">Chennai</option>
          <option value="Coimbatore">Coimbatore</option>
          <option value="Trichy">Trichy</option>
          <option value="Madurai">Madurai</option>
          <option value="Bangalore">Bangalore</option>
        </select>
        <select id="filterStatus">
          <option value="">All Status</option>
          <option value="Active">Active</option>
          <option value="Inactive">Inactive</option>
        </select>
        <button type="submit"><i class="fas fa-search"></i> Filter</button>
      </form>
      <button class="btn btn-add" onclick="showVendorModal()"><i class="fas fa-plus"></i> Add Vendor</button>
    </div>
    <section class="vendor-table-section" id="vendorTableSection">
      <table id="vendorTable">
        <thead>
          <tr>
            <th>VendorID</th>
            <th>Organization</th>
            <th>Email</th>
            <th>Phone</th>
            <th>Region</th>
            <th>Status</th>
            <th>Registered</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody>
          <!-- JS fills -->
        </tbody>
      </table>
      <div id="noVendorsFound" style="text-align:center;color:#b1b5bb;margin-top:2.2rem;display:none;font-size:1.08rem;">
        <i class="fas fa-search-minus" style="opacity:.36;font-size:1.7rem;margin-bottom:0.2rem;"></i><br>
        No vendors found.
      </div>
    </section>
  </main>
  <!-- Add/Edit Vendor Modal -->
  <div class="modal-backdrop" id="vendorModalBackdrop">
    <div class="modal" id="vendorModal" role="dialog" aria-modal="true" aria-labelledby="vendorModalLabel">
      <h2 id="vendorModalLabel">Add Vendor</h2>
      <form id="addVendorForm" onsubmit="return submitVendorForm(event)">
        <label for="orgname">Organization Name</label>
        <input type="text" id="orgname" name="orgname" minlength="3" maxlength="40" required placeholder="Vendor organization name">
        <div class="input-error" id="errOrg"></div>
        <label for="vendoremail">Email</label>
        <input type="email" id="vendoremail" name="vendoremail" required placeholder="Vendor email">
        <div class="input-error" id="errEmail"></div>
        <label for="vendorphone">Phone</label>
        <input type="tel" id="vendorphone" name="vendorphone" pattern="\d{10,15}" minlength="10" maxlength="15" required placeholder="Vendor phone">
        <div class="input-error" id="errPhone"></div>
        <label for="region">Region</label>
        <select id="region" name="region" required>
          <option value="">Select</option>
          <option value="Chennai">Chennai</option>
          <option value="Coimbatore">Coimbatore</option>
          <option value="Trichy">Trichy</option>
          <option value="Madurai">Madurai</option>
          <option value="Bangalore">Bangalore</option>
        </select>
        <div class="input-error" id="errRegion"></div>
        <label for="status">Status</label>
        <select name="status" id="status" required>
          <option value="Active">Active</option>
          <option value="Inactive">Inactive</option>
        </select>
        <div class="modal-footer">
          <button class="btn" type="submit"><i class="fas fa-check"></i> Save</button>
          <button class="btn btn-secondary" type="button" onclick="closeVendorModal()"><i class="fas fa-times"></i> Cancel</button>
        </div>
      </form>
    </div>
  </div>
  <script>
    let vendors = [
      {id:"V001", org:"Sunrise Travels", email:"sunrise@vendor.com", phone:"9123456781", region:"Chennai", status:"Active", registered:"2024-04-13"},
      {id:"V002", org:"Green Bus Pvt Ltd", email:"green.bus@vendor.com", phone:"9887766554", region:"Bangalore", status:"Inactive", registered:"2024-03-31"},
      {id:"V003", org:"Starline Coaches", email:"starline@vendor.com", phone:"9954321122", region:"Trichy", status:"Active", registered:"2024-02-21"},
      {id:"V004", org:"Omega Travels", email:"omega@vendor.com", phone:"9000001234", region:"Trichy", status:"Active", registered:"2024-02-03"},
      {id:"V005", org:"Central India Buses", email:"centralindia@vendor.com", phone:"9198989812", region:"Madurai", status:"Active", registered:"2024-01-15"}
    ];
    document.addEventListener('DOMContentLoaded', renderVendors, false);

    function renderVendors() {
      const tbody = document.querySelector('#vendorTable tbody');
      tbody.innerHTML = "";
      let filtered = filterVendorsData();
      if(filtered.length === 0) {
        document.getElementById('noVendorsFound').style.display = "block";
      } else {
        document.getElementById('noVendorsFound').style.display = "none";
        filtered.forEach(v => {
          tbody.innerHTML += `<tr>
            <td>${v.id}</td>
            <td>${v.org}</td>
            <td>${v.email}</td>
            <td>${v.phone}</td>
            <td>${v.region}</td>
            <td>
              <span class="badge ${v.status === "Active" ? "badge-success" : "badge-inactive"}">${v.status}</span>
            </td>
            <td>${v.registered}</td>
            <td>
              <button title="Edit" class="btn-table" onclick='showVendorModal("edit","${v.id}")'><i class="fas fa-edit"></i></button>
              <button title="Delete" class="btn-table del" onclick='deleteVendor("${v.id}")'><i class="fas fa-trash-alt"></i></button>
            </td>
          </tr>`;
        });
      }
    }

    function filterVendors(event) {
      if(event) event.preventDefault();
      renderVendors();
      return false;
    }

    function filterVendorsData() {
      const q = document.getElementById('searchVendor').value.trim().toLowerCase();
      const region = document.getElementById('filterRegion').value;
      const status = document.getElementById('filterStatus').value;
      return vendors.filter(v =>
        (!q ||
          v.org.toLowerCase().includes(q) ||
          v.email.toLowerCase().includes(q) ||
          v.phone.includes(q)
        ) &&
        (!region || v.region === region) &&
        (!status || v.status === status)
      );
    }

    // Modal: Add/Edit vendor
    let editVendorId = null;
    function showVendorModal(type="add", vendorId="") {
      document.getElementById('vendorModalBackdrop').classList.add('active');
      document.body.style.overflow = "hidden";
      document.getElementById('addVendorForm').reset();
      clearVendorFormErrors();
      document.getElementById('vendorModalLabel').textContent = type === "edit" ? "Edit Vendor" : "Add Vendor";
      editVendorId = null;
      if(type === "edit" && vendorId){
        const v = vendors.find(ven=>ven.id===vendorId);
        if(v){
          editVendorId = vendorId;
          document.getElementById('orgname').value = v.org;
          document.getElementById('vendoremail').value = v.email;
          document.getElementById('vendorphone').value = v.phone;
          document.getElementById('region').value = v.region;
          document.getElementById('status').value = v.status;
        }
      }
    }
    function closeVendorModal(){
      document.getElementById('vendorModalBackdrop').classList.remove('active');
      document.body.style.overflow = "";
      editVendorId = null;
    }
    // Add/Edit form validation and submit
    function submitVendorForm(evt){
      evt.preventDefault();
      clearVendorFormErrors();
      const org = document.getElementById('orgname').value.trim();
      const email = document.getElementById('vendoremail').value.trim();
      const phone = document.getElementById('vendorphone').value.trim();
      const region = document.getElementById('region').value;
      const status = document.getElementById('status').value;
      let valid = true;
      if(org.length<3 || org.length>40){
        document.getElementById('errOrg').textContent = "Organization (3-40 chars) required";
        valid = false;
      }
      if(!/^\S+@\S+\.\S+$/.test(email)){
        document.getElementById('errEmail').textContent = "Valid email required";
        valid = false;
      }
      if(!/^\d{10,15}$/.test(phone)){
        document.getElementById('errPhone').textContent = "Phone (10-15 digits) required";
        valid = false;
      }
      if(!region){ document.getElementById('errRegion').textContent = "Select region"; valid = false;}
      if(!valid) return false;
      if(editVendorId){
        // Edit existing vendor
        const idx = vendors.findIndex(v=>v.id===editVendorId);
        if(idx >= 0){
          vendors[idx].org = org;
          vendors[idx].email = email;
          vendors[idx].phone = phone;
          vendors[idx].region = region;
          vendors[idx].status = status;
        }
      } else {
        // Add new vendor
        let newId = "V" + (Math.max(...vendors.map(v=>+v.id.replace("V","")||0),0)+1).toString().padStart(3,"0");
        vendors.unshift({
          id: newId, org, email, phone, region, status, registered: (new Date()).toISOString().slice(0,10)
        });
      }
      closeVendorModal();
      renderVendors();
      return false;
    }
    function clearVendorFormErrors() {
      document.getElementById('errOrg').textContent = "";
      document.getElementById('errEmail').textContent = "";
      document.getElementById('errPhone').textContent = "";
      document.getElementById('errRegion').textContent = "";
    }
    function deleteVendor(vid){
      if(confirm("Are you sure you want to delete this vendor?")){
        vendors = vendors.filter(v=>v.id!==vid);
        renderVendors();
      }
    }
    /* Sidebar and mobile logic */
    function toggleSidebar() {
      let sb = document.getElementById('sidebar');
      sb.classList.toggle('open');
      document.body.style.overflow = sb.classList.contains("open") ? "hidden" : "";
      document.querySelector('.sidebar-backdrop').style.display = sb.classList.contains("open") ? "block" : "none";
    }
    document.addEventListener('click',function(e){
      let sidebar=document.getElementById('sidebar');
      let toggle=document.querySelector('.mobile-menu-toggle');
      if(window.innerWidth<=768 && sidebar.classList.contains('open') &&
        !sidebar.contains(e.target) && !toggle.contains(e.target)){
          sidebar.classList.remove('open');
          document.body.style.overflow = "";
      }
    });
    // ESC closes modal
    document.addEventListener('keydown', function(e){
      if(e.key==="Escape"){
        closeVendorModal();
        document.getElementById('sidebar').classList.remove('open');
        document.body.style.overflow = "";
      }
    });
  </script>
</body>
</html>
